#!/bin/bash

this_dir=$(cd `dirname $0`;pwd)
. $this_dir/functions
sensorName=$1
sensorType=$2

[ -z "$dbDir" ] && errorExit "No data directory: $dbDir"
[ -z "$sensorName" ] && errorExit "No sensorName parameter given"
[ -z "$sensorType" ] && errorExit "No sensorType parameter given"

dbFile=$dbDir/${sensorName}.${sensorType}.rrd

#--- rrd file starts today
startDate="$(date "+%Y%m%d 00:00")"
startDateEpoc=$(date -d "$startDate" "+%s")

logIt "  - Creating new RRD $dbFile start: $startDate "

#--- 259200 samples of 10 seconds -> 1 month
#--- 86400 sampes of 1 minute -> 60 days
#--- 86400 sampes of 10 minutes -> 600 days
rrdtool create $dbFile \
  --start $startDateEpoc \
  --step 10 \
  DS:temperature:GAUGE:259200:U:U \
  RRA:AVERAGE:0.5:1:259200 \
  RRA:AVERAGE:0.5:6:86400 \
  RRA:AVERAGE:0.5:60:86400 \
  RRA:MIN:0.5:1:259200 \
  RRA:MIN:0.5:6:86400 \
  RRA:MIN:0.5:60:86400 \
  RRA:MAX:0.5:1:259200 \
  RRA:MAX:0.5:6:86400 \
  RRA:MAX:0.5:60:86400

chmod g+w $dbFile
sudo chgrp www-data $dbFile
